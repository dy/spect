const e=e=>e?.map?.((e=>e[3]())),t=new FinalizationRegistry(e);class s{#e=[];constructor(e){this[0]=e,t.register(this,this.#e)}get value(){return this[0]}set value(e){this[0]=e;for(let t of this.#e)t[4]?.call?.(),t[4]=t[0](e)}valueOf(){return this.value}toString(){return this.value}[Symbol.toPrimitive](e){return this.value}subscribe(e,t,s){t=(e=e?.next||e)?.error||t,s=e?.complete||s;const i=this.#e,l=()=>(n[4]?.call?.(),i.splice(i.indexOf(n)>>>0,1)),n=[e,t,s,l,void 0!==this[0]?e(this[0]):null];return i.push(n),l.unsubscribe=l}map(e){const t=new s;return this.subscribe((s=>t.value=e(s))),t}error(e){this.#e.map((t=>t[1]?.(e)))}[Symbol.observable||=Symbol.for("observable")](){return this}async*[Symbol.asyncIterator](){let e,t=[],s=new Promise((t=>e=t)),i=this.subscribe((i=>(t.push(i),e(),s=new Promise((t=>e=t)))));try{for(;;)yield*t.splice(0),await s}catch{}i()}[Symbol.dispose||=Symbol("dispose")](){e(this.#e),delete this[0],this.#e=null}}let i=0,l={},n={},a={},r={},h={},o=new WeakMap,c=document,d="undefined"!=typeof AnimationEvent,m=c.head.appendChild(c.createElement("style")),u=Symbol();function f(e,t,s){if(e&&e.raw)return new p(null,String.raw.apply(null,arguments));if("string"==typeof e)return new p(null,e,t);if(!t||"function"==typeof t){s=t;let i=e;i||(i=[]),i.nodeType&&(i=[i]);const l=new p(null,null,s);return i.forEach((e=>l.add(e))),l}return new p(e,t,s)}class p extends Array{#t;#s;#i;#l;#n;#a;#r;#h;#o;constructor(e,t,o){if("number"==typeof e)return Array(e);if(super(),this.#t=new s(this),this.#s=new WeakMap,this.#i=new WeakSet,this.#l=new WeakMap,this.#n=e,this.#a=o,this[u]=Object.getPrototypeOf(this),!t)return;(e||c).querySelectorAll(t).forEach((e=>{this[u].add.call(this,e)}));const f=/(?:#([\w:-]+)|\[\s*name=['"]?([\w:-]+)['"]?\s*\]|\.([\w:-]+)|([\*\w:-]+))(\[[^\]]+\]|\.[\w:-]+)*$/;if(this.#r=t.split(/\s*,\s*/).map((e=>{const t=(e=new String(e)).match(f);if(e.filter=e,!t)return e;let[s,i,h,o,c,d]=t;return i?(l[e.id=i]=l[i]||[]).push(this):h?(r[e.name=h]=r[h]||[]).push(this):o?(n[e.class=o]=n[o]||[]).push(this):c&&(e.tag=c=c.toUpperCase(),a[c]=a[c]||[]).push(this),d?e.filter=e.slice(0,t.index)+e.slice(-d.length):t.index||delete e.filter,e})),this.#o=this.#r.some((e=>e.filter)),!d||!this.#r.every((e=>e.tag&&!e.filter))){let e=h[this.#r];if(!e){const{sheet:t}=m,{cssRules:s}=t;e=h[this.#r]=[],e.id="⬡-"+(i++).toString(36),t.insertRule(`@keyframes ${e.id}{}`,s.length),t.insertRule(`${this.#r.map((t=>t+`:not(.${e.id})`))}{animation:${e.id}}`,s.length),t.insertRule(`.${e.id}{animation:${e.id}}`,s.length),t.insertRule(`${this.#r.map((t=>t+`.${e.id}`))}{animation:unset;animation:revert}`,s.length),e.rules=[].slice.call(s,-4),e.onanim=t=>{if(t.animationName!==e.id)return;t.stopPropagation(),t.preventDefault();let{target:s}=t;s.classList.contains(e.id)?(s.classList.remove(e.id),e.forEach((e=>e.delete(s)))):(s.classList.add(e.id),e.forEach((e=>e[u].add.call(e,s,!1))))},c.addEventListener("animationstart",e.onanim,!0)}this.#h=e.id,e.push(this)}}add(e,t=this.#o){e&&(this.#s.has(e)||t&&!e.matches(this.#r)||(!this.#n||this.#n!==e&&this.#n.contains(e))&&(this.push(e),this.#s.set(e,[e.id,e.name]),e.name&&(this[e.name]=e),e.id&&(this[e.id]=e),this.#i.has(e)&&this.#i.delete(e),o.has(e)&&o.get(e).has(this)||(o.has(e)||o.set(e,new Set),o.get(e).add(this),e.classList.add("⬡"),this.#l.set(e,this.#a?.(e)),this.#t.value=this)))}delete(e,t=!1){if(!this.#s.has(e))return;this.length&&this.splice(this.indexOf(e>>>0,1),1);const[s,i]=this.#s.get(e);i&&delete this[i],s&&delete this[s],this.#s.delete(e),this.#i.add(e);const l=()=>{if(!this.#i.has(e)||!this.#t)return;if(this.#i.delete(e),!o.has(e))return;const t=this.#l.get(e);t&&(t.call?t(e):t.then&&t.then((e=>e&&e.call&&e()))),this.#l.delete(e),this.#t.value=this,o.get(e).delete(this),o.get(e).size||(o.delete(e),e.classList.remove("⬡"))};t?l():requestAnimationFrame(l)}[Symbol.observable||=Symbol.for("observable")](){return this.#t}item(e){return e<0?this[this.length+e]:this[e]}namedItem(e){return this[e]}has(e){return this.#s.has(e)}dispose(){if(this.#r&&this.#r.forEach((({id:e,class:t,name:s,tag:i})=>{e&&l[e].splice(l[e].indexOf(this)>>>0,1),s&&r[s].splice(r[s].indexOf(this)>>>0,1),t&&n[t].splice(n[t].indexOf(this)>>>0,1),i&&a[i].splice(a[i].indexOf(this)>>>0,1)})),this.#h){const e=h[this.#r];e.splice(e.indexOf(this)>>>0,1),e.length||(c.removeEventListener("animationstart",e.onanim),delete h[this.#r],e.rules&&e.rules.forEach((e=>{let t=[].indexOf.call(m.sheet.cssRules,e);~t&&m.sheet.deleteRule(t)})))}let e=[...this];this.length=0,e.forEach((e=>this.delete(e,!0))),this.#t[Symbol.dispose]?.(),this.#t=null}[Symbol.dispose||=Symbol("dispose")](){return this.dispose}}const b=(e,t,s)=>{t&&e&&[].forEach.call(e.nodeType?[e]:e,(e=>t.forEach((t=>t[u].add.call(t,e,s)))))},y=e=>[e.classList.contains("⬡")?e:null,...e.getElementsByClassName("⬡")].forEach((e=>o.has(e)&&o.get(e).forEach((t=>t.delete(e)))));new MutationObserver((e=>{for(let t of e){let{addedNodes:e,removedNodes:s,target:i}=t;if(!d){y(i);for(let e in h)b([i,...i.querySelectorAll(e)],h[e],!0)}s.forEach((e=>1===e.nodeType&&y(e))),e.forEach((e=>{if(1===e.nodeType){if(e.id&&(b(e,l[e.id]),e.getElementById))for(let t in l)b(e.getElementById(t),l[t]);if(e.name){b(e,r[e.name]);for(let t in r)b(e.getElementsByName(t),r[t])}if(e.className){e.classList.forEach((t=>b(e,n[t])));for(let t in n)b(e.getElementsByClassName(t),n[t])}b(e,a[e.tagName]);for(let t in a)b(e.getElementsByTagName(t),a[t])}}))}})).observe(c,{childList:!0,subtree:!0,attributes:!d});export{p as SelectorCollection,f as default};