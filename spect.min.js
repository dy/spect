class e{#e=[];constructor(e){this[0]=e}get value(){return this[0]}set value(e){this[0]=e;for(let t of this.#e)t[4]?.call?.(),(t[0]||t[1]||t[2]).deref()?t[4]=t[0].deref()?.(e):t[3]()}valueOf(){return this.value}toString(){return this.value}[Symbol.toPrimitive](e){return this.value}subscribe(e,t,s){t=(e=e?.next||e)?.error||t,s=e?.complete||s;const i=()=>this.#e.length&&this.#e.splice(this.#e.indexOf(n)>>>0,1),n=[e&&new WeakRef(e),t&&new WeakRef(t),s&&new WeakRef(s),i,void 0!==this[0]?e(this[0]):null];return this.#e.push(n),i.unsubscribe=i}map(t){const s=new e;return this.subscribe((e=>s.value=t(e))),s}error(e){this.#e.map((t=>t[1]?.deref()?.(e)))}[Symbol.observable||=Symbol.for("observable")](){return this}async*[Symbol.asyncIterator](){let e,t=[],s=new Promise((t=>e=t)),i=this.subscribe((i=>(t.push(i),e(),s=new Promise((t=>e=t)))));try{for(;;)yield*t.splice(0),await s}catch{}i()}dispose(){this[0]=null;const e=this.#e.map((e=>(e[4]?.call?.(),e[2]?.deref()?.(),e[3])));this.#e.length=0,e.map((e=>e()))}[Symbol.dispose||=Symbol("dispose")](){return this.dispose()}}let t=0,s={},i={},n={},l={},r={},a=new WeakMap,h=document,o="undefined"!=typeof AnimationEvent,c=h.head.appendChild(h.createElement("style")),d=Symbol();function m(e,t,s){if(e&&e.raw)return new u(null,String.raw.apply(null,arguments));if("string"==typeof e)return new u(null,e,t);if(!t||"function"==typeof t){s=t;let i=e;i||(i=[]),i.nodeType&&(i=[i]);const n=new u(null,null,s);return i.forEach((e=>n.add(e))),n}return new u(e,t,s)}Symbol.dispose||=Symbol("dispose");class u extends Array{#t;#s;#i;#n;#l;#r;#a;#h;#o;constructor(a,m,u){if("number"==typeof a)return Array(a);if(super(),this.#t=new e(this),this.#s=new WeakMap,this.#i=new WeakSet,this.#n=new WeakMap,this.#l=a,this.#r=u,this[d]=Object.getPrototypeOf(this),!m)return;(a||h).querySelectorAll(m).forEach((e=>{this[d].add.call(this,e)}));const f=/(?:#([\w:-]+)|\[\s*name=['"]?([\w:-]+)['"]?\s*\]|\.([\w:-]+)|([\*\w:-]+))(\[[^\]]+\]|\.[\w:-]+)*$/;if(this.#a=m.split(/\s*,\s*/).map((e=>{const t=(e=new String(e)).match(f);if(e.filter=e,!t)return e;let[r,a,h,o,c,d]=t;return a?(s[e.id=a]=s[a]||[]).push(this):h?(l[e.name=h]=l[h]||[]).push(this):o?(i[e.class=o]=i[o]||[]).push(this):c&&(e.tag=c=c.toUpperCase(),n[c]=n[c]||[]).push(this),d?e.filter=e.slice(0,t.index)+e.slice(-d.length):t.index||delete e.filter,e})),this.#o=this.#a.some((e=>e.filter)),!o||!this.#a.every((e=>e.tag&&!e.filter))){let e=r[this.#a];if(!e){const{sheet:s}=c,{cssRules:i}=s;e=r[this.#a]=[],e.id="⬡-"+(t++).toString(36),s.insertRule(`@keyframes ${e.id}{}`,i.length),s.insertRule(`${this.#a.map((t=>t+`:not(.${e.id})`))}{animation:${e.id}}`,i.length),s.insertRule(`.${e.id}{animation:${e.id}}`,i.length),s.insertRule(`${this.#a.map((t=>t+`.${e.id}`))}{animation:unset;animation:revert}`,i.length),e.rules=[].slice.call(i,-4),e.onanim=t=>{if(t.animationName!==e.id)return;t.stopPropagation(),t.preventDefault();let{target:s}=t;s.classList.contains(e.id)?(s.classList.remove(e.id),e.forEach((e=>e.delete(s)))):(s.classList.add(e.id),e.forEach((e=>e[d].add.call(e,s,!1))))},h.addEventListener("animationstart",e.onanim,!0)}this.#h=e.id,e.push(this)}}add(e,t=this.#o){e&&(this.#s.has(e)||t&&!e.matches(this.#a)||(!this.#l||this.#l!==e&&this.#l.contains(e))&&(this.push(e),this.#s.set(e,[e.id,e.name]),e.name&&(this[e.name]=e),e.id&&(this[e.id]=e),this.#i.has(e)&&this.#i.delete(e),a.has(e)&&a.get(e).has(this)||(a.has(e)||a.set(e,new Set),a.get(e).add(this),e.classList.add("⬡"),this.#n.set(e,this.#r?.(e)),this.#t.value=this)))}delete(e,t=!1){if(!this.#s.has(e))return;this.length&&this.splice(this.indexOf(e>>>0,1),1);const[s,i]=this.#s.get(e);i&&delete this[i],s&&delete this[s],this.#s.delete(e),this.#i.add(e);const n=()=>{if(!this.#i.has(e))return;if(this.#i.delete(e),!a.has(e))return;const t=this.#n.get(e);t&&(t.call?t(e):t.then&&t.then((e=>e&&e.call&&e()))),this.#n.delete(e),this.#t.value=this,a.get(e).delete(this),a.get(e).size||(a.delete(e),e.classList.remove("⬡"))};t?n():requestAnimationFrame(n)}[Symbol.observable||=Symbol.for("observable")](){return this.#t}item(e){return e<0?this[this.length+e]:this[e]}namedItem(e){return this[e]}has(e){return this.#s.has(e)}dispose(){if(this.#a&&this.#a.forEach((({id:e,class:t,name:r,tag:a})=>{e&&s[e].splice(s[e].indexOf(this)>>>0,1),r&&l[r].splice(l[r].indexOf(this)>>>0,1),t&&i[t].splice(i[t].indexOf(this)>>>0,1),a&&n[a].splice(n[a].indexOf(this)>>>0,1)})),this.#h){const e=r[this.#a];e.splice(e.indexOf(this)>>>0,1),e.length||(h.removeEventListener("animationstart",e.onanim),delete r[this.#a],e.rules&&e.rules.forEach((e=>{let t=[].indexOf.call(c.sheet.cssRules,e);~t&&c.sheet.deleteRule(t)})))}this.#t[Symbol.dispose]();let e=[...this];this.length=0,e.forEach((e=>this.delete(e,!0)))}[Symbol.dispose](){return this.dispose}}const f=(e,t,s)=>{t&&e&&[].forEach.call(e.nodeType?[e]:e,(e=>t.forEach((t=>t[d].add.call(t,e,s)))))},p=e=>[e.classList.contains("⬡")?e:null,...e.getElementsByClassName("⬡")].forEach((e=>a.has(e)&&a.get(e).forEach((t=>t.delete(e)))));new MutationObserver((e=>{for(let t of e){let{addedNodes:e,removedNodes:a,target:h}=t;if(!o){p(h);for(let e in r)f([h,...h.querySelectorAll(e)],r[e],!0)}a.forEach((e=>1===e.nodeType&&p(e))),e.forEach((e=>{if(1===e.nodeType){if(e.id&&(f(e,s[e.id]),e.getElementById))for(let t in s)f(e.getElementById(t),s[t]);if(e.name){f(e,l[e.name]);for(let t in l)f(e.getElementsByName(t),l[t])}if(e.className){e.classList.forEach((t=>f(e,i[t])));for(let t in i)f(e.getElementsByClassName(t),i[t])}f(e,n[e.tagName]);for(let t in n)f(e.getElementsByTagName(t),n[t])}}))}})).observe(h,{childList:!0,subtree:!0,attributes:!o});export{u as SelectorCollection,m as default};