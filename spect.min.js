Symbol.observable||=Symbol("observable");const e=new FinalizationRegistry((e=>e.call?.())),t=(...e)=>new l(...e),s=e=>e?.map?.((e=>e[3]())),i=new FinalizationRegistry(s);class l{#e=[];#t=[];constructor(...e){this.#t=e,i.register(this,this.#e)}get value(){return this.#t[0]}set value(e){this.#t[0]=e,this.set(...this.#t)}set(...e){this.#t=e;for(let e of this.#e)e[4]?.call?.(),e[4]=e[0](...this.#t)}valueOf(){return this.value}toString(){return this.value}toJSON(){return this.value}[Symbol.toPrimitive](e){return this.value}*[Symbol.iterator](){for(let e of this.#t)yield e}subscribe(e,t,s){t=(e=e?.next||e)?.error||t,s=e?.complete||s;const i=this.#e,l=()=>(a[4]?.call?.(),i.splice(i.indexOf(a)>>>0,1)),a=[e,t,s,l,this.#t.length?e(...this.#t):null];return i.push(a),l.unsubscribe=l}error(e){this.#e.map((t=>t[1]?.(e)))}[Symbol.observable||=Symbol.for("observable")](){return this}async*[Symbol.asyncIterator](){let e,t=[],s=new Promise((t=>e=t)),i=this.subscribe((i=>(t.push(i),e(),s=new Promise((t=>e=t)))));try{for(;;)yield*t.splice(0),await s}catch{}i()}[Symbol.dispose||=Symbol("dispose")](){s(this.#e),this.#t=null,this.#e=null}}l.from=t.from=(...t)=>{let s,i,a;return t[t.length-1]?.call&&(s=t.pop()),i=[],t.map(((t,l)=>{return(e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then))(t)?(r=e=>(i[l]=e,a&&(s?a.value=s(...i):a.set(...i))),(n=t)&&(d=(n[Symbol.observable]?.()||n).subscribe?.(r,h,undefined),c=d&&(()=>d.unsubscribe?.())||n.set&&n.call?.(o,r)||(n.then?.((e=>{!o&&r(e)}),h)||(async e=>{try{for await(e of n){if(o)return;r(e)}}catch(e){}})())&&(e=>o=1),e.register(n,c),c)):i[l]=t;var n,r,h,o,c,d})),a=s?new l(s(...i)):new l(...i)};let a=0,n={},r={},h={},o={},c={},d=new WeakMap,u=document,m="undefined"!=typeof AnimationEvent,f=u.head.appendChild(u.createElement("style")),b=Symbol();function p(e,t,s){if(e&&e.raw)return new y(null,String.raw.apply(null,arguments));if("string"==typeof e)return new y(null,e,t);if(!t||"function"==typeof t){s=t;let i=e;i||(i=[]),i.nodeType&&(i=[i]);const l=new y(null,null,s);return i.forEach((e=>l.add(e))),l}return new y(e,t,s)}class y extends Array{#s;#i;#l;#a;#n;#r;#h;#o;#c;constructor(e,s,i){if("number"==typeof e)return Array(e);if(super(),this.#s=t(this),this.#i=new WeakMap,this.#l=new WeakSet,this.#a=new WeakMap,this.#n=e,this.#r=i,this[b]=Object.getPrototypeOf(this),!s)return;(e||u).querySelectorAll(s).forEach((e=>{this[b].add.call(this,e)}));const l=/(?:#([\w:-]+)|\[\s*name=['"]?([\w:-]+)['"]?\s*\]|\.([\w:-]+)|([\*\w:-]+))(\[[^\]]+\]|\.[\w:-]+)*$/;if(this.#h=s.split(/\s*,\s*/).map((e=>{const t=(e=new String(e)).match(l);if(e.filter=e,!t)return e;let[s,i,a,c,d,u]=t;return i?(n[e.id=i]=n[i]||[]).push(this):a?(o[e.name=a]=o[a]||[]).push(this):c?(r[e.class=c]=r[c]||[]).push(this):d&&(e.tag=d=d.toUpperCase(),h[d]=h[d]||[]).push(this),u?e.filter=e.slice(0,t.index)+e.slice(-u.length):t.index||delete e.filter,e})),this.#c=this.#h.some((e=>e.filter)),!m||!this.#h.every((e=>e.tag&&!e.filter))){let e=c[this.#h];if(!e){const{sheet:t}=f,{cssRules:s}=t;e=c[this.#h]=[],e.id="⬡-"+(a++).toString(36),t.insertRule(`@keyframes ${e.id}{}`,s.length),t.insertRule(`${this.#h.map((t=>t+`:not(.${e.id})`))}{animation:${e.id}}`,s.length),t.insertRule(`.${e.id}{animation:${e.id}}`,s.length),t.insertRule(`${this.#h.map((t=>t+`.${e.id}`))}{animation:unset;animation:revert}`,s.length),e.rules=[].slice.call(s,-4),e.onanim=t=>{if(t.animationName!==e.id)return;t.stopPropagation(),t.preventDefault();let{target:s}=t;s.classList.contains(e.id)?(s.classList.remove(e.id),e.forEach((e=>e.delete(s)))):(s.classList.add(e.id),e.forEach((e=>e[b].add.call(e,s,!1))))},u.addEventListener("animationstart",e.onanim,!0)}this.#o=e.id,e.push(this)}}add(e,t=this.#c){e&&(this.#i.has(e)||t&&!e.matches(this.#h)||(!this.#n||this.#n!==e&&this.#n.contains(e))&&(this.push(e),this.#i.set(e,[e.id,e.name]),e.name&&(this[e.name]=e),e.id&&(this[e.id]=e),this.#l.has(e)&&this.#l.delete(e),d.has(e)&&d.get(e).has(this)||(d.has(e)||d.set(e,new Set),d.get(e).add(this),e.classList.add("⬡"),this.#a.set(e,this.#r?.(e)),this.#s.value=this)))}delete(e,t=!1){if(!this.#i.has(e))return;this.length&&this.splice(this.indexOf(e>>>0,1),1);const[s,i]=this.#i.get(e);i&&delete this[i],s&&delete this[s],this.#i.delete(e),this.#l.add(e);const l=()=>{if(!this.#l.has(e)||!this.#s)return;if(this.#l.delete(e),!d.has(e))return;const t=this.#a.get(e);t&&(t.call?t(e):t.then&&t.then((e=>e&&e.call&&e()))),this.#a.delete(e),this.#s.value=this,d.get(e).delete(this),d.get(e).size||(d.delete(e),e.classList.remove("⬡"))};t?l():requestAnimationFrame(l)}[Symbol.observable||=Symbol.for("observable")](){return this.#s}item(e){return e<0?this[this.length+e]:this[e]}namedItem(e){return this[e]}has(e){return this.#i.has(e)}dispose(){if(this.#h&&this.#h.forEach((({id:e,class:t,name:s,tag:i})=>{e&&n[e].splice(n[e].indexOf(this)>>>0,1),s&&o[s].splice(o[s].indexOf(this)>>>0,1),t&&r[t].splice(r[t].indexOf(this)>>>0,1),i&&h[i].splice(h[i].indexOf(this)>>>0,1)})),this.#o){const e=c[this.#h];e.splice(e.indexOf(this)>>>0,1),e.length||(u.removeEventListener("animationstart",e.onanim),delete c[this.#h],e.rules&&e.rules.forEach((e=>{let t=[].indexOf.call(f.sheet.cssRules,e);~t&&f.sheet.deleteRule(t)})))}let e=[...this];this.length=0,e.forEach((e=>this.delete(e,!0))),this.#s[Symbol.dispose]?.(),this.#s=null}[Symbol.dispose||=Symbol("dispose")](){return this.dispose}}const v=(e,t,s)=>{t&&e&&[].forEach.call(e.nodeType?[e]:e,(e=>t.forEach((t=>t[b].add.call(t,e,s)))))},g=e=>[e.classList.contains("⬡")?e:null,...e.getElementsByClassName("⬡")].forEach((e=>d.has(e)&&d.get(e).forEach((t=>t.delete(e)))));new MutationObserver((e=>{for(let t of e){let{addedNodes:e,removedNodes:s,target:i}=t;if(!m){g(i);for(let e in c)v([i,...i.querySelectorAll(e)],c[e],!0)}s.forEach((e=>1===e.nodeType&&g(e))),e.forEach((e=>{if(1===e.nodeType){if(e.id&&(v(e,n[e.id]),e.getElementById))for(let t in n)v(e.getElementById(t),n[t]);if(e.name){v(e,o[e.name]);for(let t in o)v(e.getElementsByName(t),o[t])}if(e.className){e.classList.forEach((t=>v(e,r[t])));for(let t in r)v(e.getElementsByClassName(t),r[t])}v(e,h[e.tagName]);for(let t in h)v(e.getElementsByTagName(t),h[t])}}))}})).observe(u,{childList:!0,subtree:!0,attributes:!m});export{y as SelectorCollection,p as default};